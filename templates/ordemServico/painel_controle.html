{% extends 'ordemServico/base.html' %}
{% load static %}
{% block title %} Painel de controle {% endblock %}
{% block style %}
<style>
    .status-dot {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 8px;
    }

    .status-concluido {
        background-color: #a8d5ba; /* Verde pastel */
        color: #155724; /* Verde escuro para texto */
    }

    .status-em-andamento {
        background-color: #fff3cd; /* Amarelo pastel */
        color: #856404; /* Amarelo escuro para texto */
    }

    .status-em-espera {
        background-color: #f8d7da; /* Vermelho pastel */
        color: #721c24; /* Vermelho escuro para texto */
    }

    .status-cell {
        padding: 8px;
        text-align: center;
        border-radius: 4px;
    }


</style>
{% endblock %}

{% block content %}
<div class="content page-title mb-5 px-4" style="min-height: 80vh;">

    <div class="container">
        <h3 class="titulo-pagina">
            <i class="bi bi-graph-up" style="margin-right: 4px;"></i>
            Painel de controle
        </h3>

        

        <div class="tabela-painel-controle p-1" style="max-height: 50vh; overflow-y: auto;">

            <h6 style="color: #78828B; font-weight: 400; font-size: 14px;" class="mb-2">
                Histórico de serviços:
            </h6>

            <div style="display: flex; align-items: center; gap: 10px;" class="mb-1">
                <!-- Campo de Pesquisa -->
                <input type="text" id="search-input" class="form-control w-50" placeholder="Pesquisar..." style=" padding: 0.5rem; font-size: 14px; background-color: var(--cinza-claro);">
            
                <!-- Botões de Filtro -->
                <button onclick="filterTable('concluída')" 
                        style="
                            display: inline-flex;
                            align-items: center;
                            padding: 8px 16px;
                            border-radius: 16px;
                            border: 1px solid #28a745;
                            background-color: #f0fdf4;
                            color: #155724;
                            font-size: 12px;
                            cursor: pointer;
                            font-weight: bold;">
                    <span style="
                            display: inline-block;
                            width: 10px;
                            height: 10px;
                            border-radius: 50%;
                            margin-right: 8px;
                            background-color: #28a745;">
                    </span>
                    Concluído
                </button>
            
                <button onclick="filterTable('em andamento')" 
                        style="
                            display: inline-flex;
                            align-items: center;
                            padding: 8px 16px;
                            border-radius: 16px;
                            border: 1px solid #ffc107;
                            background-color: #fff8e1;
                            color: #856404;
                            font-size: 12px;
                            cursor: pointer;
                            font-weight: bold;">
                    <span style="
                            display: inline-block;
                            width: 10px;
                            height: 10px;
                            border-radius: 50%;
                            margin-right: 8px;
                            background-color: #ffc107;">
                    </span>
                    Em andamento
                </button>
            
                <button onclick="filterTable('em espera')" 
                        style="
                            display: inline-flex;
                            align-items: center;
                            padding: 8px 16px;
                            border-radius: 16px;
                            border: 1px solid #dc3545;
                            background-color: #fde2e4;
                            color: #721c24;
                            font-size: 12px;
                            cursor: pointer;
                            font-weight: bold;">
                    <span style="
                            display: inline-block;
                            width: 10px;
                            height: 10px;
                            border-radius: 50%;
                            margin-right: 8px;
                            background-color: #dc3545;">
                    </span>
                    Em espera
                </button>
            
                <button onclick="filterTable('')" 
                        style="
                            display: inline-flex;
                            align-items: center;
                            padding: 8px 16px;
                            border-radius: 16px;
                            border: 1px solid #6c757d;
                            background-color: #f8f9fa;
                            color: #6c757d;
                            font-size: 12px;
                            cursor: pointer;
                            font-weight: bold;">
                    <span style="
                            display: inline-block;
                            width: 10px;
                            height: 10px;
                            border-radius: 50%;
                            margin-right: 8px;
                            background-color: #6c757d;">
                    </span>
                    Todos
                </button>
            </div>
            
            <table class="table table-hover" id="data-table">
                <thead>
                    <tr 
                        style="font-size: 12px; text-align: center;">

                        <th scope="col" style="background-color: var(--azul-principal); color: var(--cinza-claro); padding: 0.75rem; border-top-left-radius: 12px; border-bottom-left-radius: 12px;">CLIENTE</th>
                        <th scope="col" style="background-color: var(--azul-principal); color: var(--cinza-claro); padding: 0.75rem;">SERVIÇO</th>
                        <th scope="col" style="background-color: var(--azul-principal); color: var(--cinza-claro); padding: 0.75rem;">RECEBIMENTO</th>
                        <th scope="col" style="background-color: var(--azul-principal); color: var(--cinza-claro); padding: 0.75rem;">CONCLUSÃO</th>
                        <th scope="col" style="background-color: var(--azul-principal); color: var(--cinza-claro); padding: 0.75rem; border-top-right-radius: 12px; border-bottom-right-radius: 12px;">STATUS</th>
                    </tr>
                </thead>
                <tbody>
                    {% for servico in servicos %}
                    <tr id="servico-{{ servico.id }}"
                        data-status="{{ servico.get_status_display|lower }}" 
                        style="font-size: 12px; text-align: center; border-bottom: 3px solid var(--cinza-claro); cursor: pointer;" 
                        data-url="{% url 'servico' servico.id %}" 
                        onclick="window.location.href=this.getAttribute('data-url');">
                    
                        <td style="padding: 0.75rem;">{{ servico.ordem_servico.cliente.nome|truncatechars:40|upper }}</td>
                        <td>{{ servico.repositorio.nome|truncatechars:20|upper }}</td>
                        <td>{{ servico.ordem_servico.data_criacao|date:"d/m/Y" }}</td>
                        <td>
                            {% if servico.data_conclusao %}
                            {{ servico.data_conclusao|date:"d/m/Y" }}
                            {% else %}
                            NÃO CONCLUÍDO
                            {% endif %}
                        </td>
                        <td style="text-align: center;">
                            <span style="
                                display: inline-flex; 
                                align-items: center; 
                                padding: 4px 8px; 
                                border-radius: 16px; 
                                border: 1px solid 
                                    {% if servico.get_status_display|lower == 'concluída' %}#28a745{% endif %}
                                    {% if servico.get_status_display|lower == 'em andamento' %}#ffc107{% endif %}
                                    {% if servico.get_status_display|lower == 'em espera' %}#dc3545{% endif %};
                                background-color: 
                                    {% if servico.get_status_display|lower == 'concluída' %}#f0fdf4{% endif %}
                                    {% if servico.get_status_display|lower == 'em andamento' %}#fff8e1{% endif %}
                                    {% if servico.get_status_display|lower == 'em espera' %}#fde2e4{% endif %};
                                color: 
                                    {% if servico.get_status_display|lower == 'concluída' %}#155724{% endif %}
                                    {% if servico.get_status_display|lower == 'em andamento' %}#856404{% endif %}
                                    {% if servico.get_status_display|lower == 'em espera' %}#721c24{% endif %};
                            ">
                                <span style="
                                    display: inline-block; 
                                    width: 10px; 
                                    height: 10px; 
                                    border-radius: 50%; 
                                    margin-right: 8px; 
                                    background-color: 
                                        {% if servico.get_status_display|lower == 'concluída' %}#28a745{% endif %}
                                        {% if servico.get_status_display|lower == 'em andamento' %}#ffc107{% endif %}
                                        {% if servico.get_status_display|lower == 'em espera' %}#dc3545{% endif %};
                                ">
                                </span>
                                {{ servico.get_status_display|upper }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}

<!-- FILTRA A TABELA PELO NOME DO CLIENTE -->
<script>
    function filterTable() {
        // Obtém o valor digitado no campo de pesquisa
        let input = document.getElementById('search-input');
        let filter = input.value.toLowerCase();
        let table = document.getElementById('data-table');
        let tr = table.getElementsByTagName('tr');

        // Loop através das linhas da tabela (ignorando o cabeçalho)
        for (let i = 1; i < tr.length; i++) {  // Começa do índice 1 para ignorar o cabeçalho
            let tdArray = tr[i].getElementsByTagName('td');
            let found = false;

            // Verifica se algum dos campos (td) da linha corresponde ao filtro
            for (let j = 0; j < tdArray.length; j++) {
                if (tdArray[j]) {
                    let txtValue = tdArray[j].textContent || tdArray[j].innerText;
                    if (txtValue.toLowerCase().indexOf(filter) > -1) {
                        found = true;
                        break;
                    }
                }
            }

            // Mostra ou oculta a linha com base na pesquisa
            if (found) {
                tr[i].style.display = '';
            } else {
                tr[i].style.display = 'none';
            }
        }
    }
</script>

<!-- FILTRA A TABELA PELO STATUS DO SERVIÇO -->
<script>
    function filterTable(status) {
        const rows = document.querySelectorAll('#data-table tbody tr');
        rows.forEach(row => {
            const rowStatus = row.getAttribute('data-status');
            if (status === '' || rowStatus === status) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }
</script>
{% endblock %}